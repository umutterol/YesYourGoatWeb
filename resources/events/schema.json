{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://example.com/yesyourgoat/events.schema.json",
  "title": "YesYourGoat Events Schema",
  "type": "array",
  "items": {
    "type": "object",
    "additionalProperties": false,
    "required": ["id", "title", "body", "tags", "weights", "left", "right"],
    "properties": {
      "id": {"type": "string", "pattern": "^[a-z0-9_]+$"},
      "title": {"type": "string", "maxLength": 50},
      "body": {"type": "string", "maxLength": 120},
      "tags": {
        "type": "array",
        "minItems": 1,
        "items": {
          "type": "string",
          "enum": [
            "player_drama",
            "raid_logistics",
            "dev_server",
            "meta_shifts",
            "community_pr",
            "meta_economy",
            "raid_loot",
            "raid_night_check"
          ]
        }
      },
      "weights": {
        "type": "object",
        "additionalProperties": false,
        "required": ["base"],
        "properties": {
          "base": {"type": "integer", "minimum": 1, "maximum": 10},
          "rep_low": {"type": "integer", "minimum": -5, "maximum": 5},
          "rep_high": {"type": "integer", "minimum": -5, "maximum": 5}
        }
      },
      "left": {"$ref": "#/definitions/choice"},
      "right": {"$ref": "#/definitions/choice"}
    },
    "definitions": {
      "effects": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "funds": {"type": "integer", "minimum": -3, "maximum": 3},
          "reputation": {"type": "integer", "minimum": -3, "maximum": 3},
          "readiness": {"type": "integer", "minimum": -3, "maximum": 3},
          "morale_all": {"type": "integer", "minimum": -3, "maximum": 3}
        },
        "patternProperties": {
          "^morale_[a-z]+$": {"type": "integer", "minimum": -3, "maximum": 3}
        }
      },
      "hook": {
        "type": "object",
        "additionalProperties": false,
        "required": ["when", "effect"],
        "properties": {
          "when": {
            "type": "string",
            "pattern": "^(trait:[a-z_]+|morale:(<|<=|>|>=|==)[0-9]{1,3})$"
          },
          "effect": {"$ref": "#/definitions/effects"}
        }
      },
      "choice": {
        "type": "object",
        "additionalProperties": false,
        "required": ["label", "effects"],
        "properties": {
          "label": {"type": "string", "maxLength": 40},
          "effects": {"$ref": "#/definitions/effects"},
          "hooks": {
            "type": "array",
            "items": {"$ref": "#/definitions/hook"}
          }
        }
      }
    }
  }
}
